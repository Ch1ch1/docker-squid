kind: pipeline
type: docker
name: Building..
node:
  drone: ch1
  drone: nimi

steps:
- name: build & push
  image: plugins/docker
  settings:
    repo: ch1ch1/squid
    tags: [ "alpine3.12","latest" ]
    username: ch1ch1
    password:
      from_secret: dockerhub-password
----
kind: pipeline
type: exec
name: Updating..
depends_on:
  - Building..
trigger:
  status:
    - success
clone:
  disable: true

steps:
- name: update & restart service
  commands:
   - /var/tmp/updatesquid
---
kind: pipeline
type: docker
name: Alerting..
node:
  drone: ch1
  drone: nimi
depends_on:
    - Building..
    - Updating..
clone:
  disable: true

steps:

- name: Alerting
  image: plugins/webhook
  settings:
    urls:
     from_secret: webhookgotify
    content_type: application/json
    template: |
      {
       "message": "{{ build.status }}.",
       "priority": 5,
       "title": "Squid build"
      }
  when:
    status: [ success, failure ] 
